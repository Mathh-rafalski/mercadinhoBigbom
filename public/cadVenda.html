<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Simple Sidebar - Start Bootstrap Template</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="css/simple-sidebar.css" rel="stylesheet">
  <style>
    .border-right {
      border-right: 1px solid black !important
    }

    img {
      border-radius: 50%;
    }


    .tarefa {
      background: blue;
      width: 20%;
      min-height: 230px;
      align-items: center;
      margin-top: 10%;
      background-image: linear-gradient(#bb7ab3, #3b3175);
      background: black;
    }

    .form {
      text-align: center;
      padding-top: 4%;
    }

    .lbl {
      margin-top: 4px;
      font-weight: bold;
      color: white;
    }

    .salvar {
      margin-top: 10%;
      float: right;

    }

    .butao {
      border-radius: 10px;
      font-weight: bold;
      display: inline-block;
      text-align: center;
      transition: all 1s;
      cursor: pointer;
      margin-top: 7%;

    }

    .msg {
      text-align: center;
      height: 50px;
      width: 20%;
      margin-top: 2%;
      margin-left: 46.5%;
      font-size: 24px;
      visibility: hidden;
      font-weight: bold;
    }

    .button {
      background-color: white;
      /* Green */
      border-color: #008CBA;
      color: black;
      padding: 16px 32px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin: 4px 2px;
      transition-duration: 0.4s;
      cursor: pointer;
    }

    .adc {
      float: left;
      margin-left: 5%;
      margin-top: 9px;
    }

    .qtd {
      float: left;
      margin-left: 3%;
      margin-top: 9px;
    }

    .bot {
      float: left;
      margin-left: 3%;
      margin-top: 9px;
    }

    .btn:hover {
      border-color: #008CBA
    }

    .pesq {
      width: 200px;
    }

    .prod {
      float: left;
      width: 25%;
      margin-top: 5%;
      border: 1px solid black;
      border-right: 1px solid white;

    }

    .quantidade {
      float: left;
      width: 8%;
      margin-top: 5%;
      border: 1px solid black
    }

    .home {
      text-align: initial;
    }

    .rem {
      margin-top: 5%;
      border: 1px solid black;
      border-left: 1px solid white;
      width: 5%;
      float: left;
      text-align: center;
    }

    .valor {
      float: left;
      width: 20%;
      margin-top: 5%;
      border: 1px solid black;
      border-left: 1px solid white;
    }

    .top {
      margin-left: 2%;
    }

    .vish {
      border: 1px solid black;
    }

    .texto {
      padding-left: 5px;
    }

    .finalizar {
      position: absolute;
      bottom: 100px;
      right: 100px;
      border-color: black;

      font-size: 18px;
    }

    .final {
      position: absolute;
      bottom: 150px;
      right: 100px;
      width: 10%;
    }

    .insert {
      border: 1px solid black;
      min-height: 60px;
      width: 32%;
      border-bottom: 1px solid white
    }

    a:hover {
      color: black;
      background-color: white;
    }

    .bg {
      background-color: #19b7d0
    }

    .text {
      border-top: 1px solid black;
      width: 100%;
    }

    .bt {
      margin-left: 5px;
    }

    .val {
      margin-right: 5px;
    }

    a:hover {
      color: black;
      background-color: white;
    }

    .bg {
      background-color: #19b7d0
    }

    .d-flex {
      font-family: 'Courier New', Courier, monospace;
    }

    .alo {
      margin-top: 5px;
    }

    .txt {
      font-size: 20px;
      font-weight: bold;
      position: absolute;
      top: 170px;
      left: 266px;
      visibility: hidden;
    }

    .porque {
      border-top: 1px solid black;
    }

    .textFinal {
      text-align: end;

    }
    a.deletar:hover {
      font-family: cursive;
    }
    .tabela {
      margin-top: 5%;
      margin-left: 2%;
      
    }
    .tabValor {
      margin-left: 8%;
      float: left;
    }
    .tabQtd {
      margin-left: 8%;
      float: left;
    }
    
    .oloco {
      border: 1px solid black;
      height: 50%;
      width: 50%;
    }
    .remover {
      margin-left: 6%;
      float: left;
    }
    .novoQ {
      margin-left: 12%;
    }
    .novoT {
      float: left;
      width: 80%;
      
    }
    .novoP {
      margin-left: 2%;

      }
      .novoV {
        margin-left: 16%;
      }
    .deletar {
      margin-left: 4%;
    }
      
    
  </style>
</head>

<body>

  <div class="d-flex" id="wrapper">

    <!-- Sidebar -->
    <div class="border-right bg" id="sidebar-wrapper">
      <div class="sidebar-heading">
        <a href="/">Menu</a>
      </div>
      <div class="image">
        <img src="rato.png" alt="homem" width="200" height="180">
      </div>
      <div class="list-group list-group-flush itens">
        <div class="dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            Vendas
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
            <a class="dropdown-item" href="/cadVenda">Nova venda</a>
            <a class="dropdown-item" href="/listVenda">Lista Venda</a>
          </div>
        </div>

        <!-- Mudar o id da navbra-->
        <div class="dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarProduto" role="button" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            Produtos
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarProduto">
            <a class="dropdown-item" href="/cadProduto">Novo Produto</a>
            <a class="dropdown-item" href="/listProduto">Lista Produto</a>
          </div>
        </div>
      </div>
    </div>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">

      <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <button class="btn btn-primary" id="menu-toggle">Toggle Menu</button>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>


      </nav>

      <div class="container-fluid home">
        <div class='txt' id='txt'>
          <span>NÃ£o existe este produto<span>
        </div>
        <div class="insert">
          <div class='alo'>
            <div class="adc">
              <input type="number" class="pesq" id="pesq" name="pesq" placeholder="ID" min='1' max='99999'><br>
            </div>
            <div class="qtd">
              <input type="number" class="quant" id='qtd' name="qtd" placeholder="quant" min='1' max='99999'><br>
            </div>
            <div class="bot">
              <button type="button" class="btn btn-default btn-sm" onclick="adicionar()">ADD</button>
            </div>
          </div>
        </div>
        <div class='oloco'>
        <div id='tabela' class='row tabela'>
          <span class='tabProd'>Produto</span>
          <span class='tabQtd'>Quant</span>
          <span class='tabValor' style='float: right; margin-right: 3%;'>Valor</span>
          <span class='remover'>Remover</span>
        </div>
      </div>
    
        <input id='final' type="text" class='final' placeholder="Valor Final" readonly>
      </div>
      <div class='salvar'>
        <button type="button" class="finalizar btn btn-default btn-sm" onclick="finalizar()">Finalizar</button>
      </div>
    </div>
  </div>
  </div>
  <!-- /#page-content-wrapper -->

  </div>
  <!-- /#wrapper -->
</body>
<!-- Bootstrap core JavaScript -->
<script src="vendor/jquery/jquery.min.js"></script>
<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Menu Toggle Script -->
<script>
  $("#menu-toggle").click(function (e) {
    e.preventDefault();
    $("#wrapper").toggleClass("toggled");
  });
  var json = [];
  var test = [];
  var total = 0;
  function adicionar() {
    // adicionar o id posto na url pra pegar o prod do banco
    let id = document.getElementById('pesq').value
    console.log('Getting...');
    let url = 'http://localhost/produto/' + id
    console.log(url)
    fetch(url, {
      method: 'get',
      headers: {
        'Content-Type': 'application/json'
      },
    }).then(response => response.json())
      .then(data => {
        console.log(data)
        // if ($("element class or id name").css("property") == "value") {
        document.getElementById("txt").style.visibility = "hidden";
        if (isNaN(data.valor)) {
          document.getElementById("txt").style.visibility = "visible";
          // document.getElementById("p2").style.visibility = "hidden";
          return;
        }
        console.log('ignorado')
        let produto = data.nome
        let tabela = document.getElementById('tabela')
        let qtd = document.getElementById('qtd').value
        let valor = data.valor
        let valorTotal = valor * qtd
        var f = valorTotal.toLocaleString('pt-br', { style: 'currency', currency: 'BRL' });
        tabela.innerHTML += ` <div id='${id}' class='row novoT'>
          <span class='novoP'>${data.nome}</span>
          <span class='novoQ'>${qtd}</span>
          <span class='novoV' style='float: right; margin-right: 3%;'>${f}</span>
          <a type='button'onclick='excluir(${id},${valorTotal})' class='deletar'>del<a>
        </div>`
        

      
        /*divRem.innerHTML += `<div class='porque' id='${id}'><a type='button'onclick='excluir(${id})' class='deletar'>del<a><div>`
        divValor.innerHTML += `<div class='textFinal text' id='${valorTotal}'>
          <span class="texto val">${f}<span>
            </div>`*/
        let inp = document.getElementById("final")
        total += parseFloat(valorTotal)
        
        inp.value = total.toLocaleString('pt-br', { style: 'currency', currency: 'BRL' });
        let obj = {
          'quantidade': qtd,
          'produto_id': data.id
        }
        let teste = {
          'nome': data.nome,
          'quantidade': qtd,
          'valor': valorTotal,
          'id': data.id
        }
        test.push(teste)
        json.push(obj)

      });
  }
  function finalizar() {
    /* let data = new Date();
     let jsonObj = {
       'dataHora': data
     }
     console.log('Posting...');
     fetch('http://localhost/postVenda', {
       method: 'post',
       headers: {
         'Content-Type': 'application/json'
       },
       body: JSON.stringify(jsonObj)
     }).then(function (response) {
     })
     let vendaId = 1;
     fetch('http://localhost/getVendas', {
       method: 'get',
       headers: {
         'Content-Type': 'application/json'
       },
     }).then(response => response.json())
       .then(data => {
         console.log(data)
         data.forEach(element => {
           vendaId = element['id']
         });
       });
       */
    var objeto = {
      'itens': json
    }
    console.log(objeto.itens)
    fetch('http://localhost/postVendaItem', {
      method: 'post',
      headers: {
        'Content-Type': 'application/json'
      },


      body: JSON.stringify(objeto)
    }).then(function (response) {
      res.send('fala fi')
    })
  }
  function excluir(id,valor) {
    document.getElementById(id).remove()
    total -= valor
    document.getElementById("final").value = total.toLocaleString('pt-br', { style: 'currency', currency: 'BRL' });

    }
  


</script>



</html>